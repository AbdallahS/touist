#
# MaÃ«l Valais <mael.valais@gmail.com>
#
# This Travis-ci configuration file has been writen to automate
# the building process and make deploying the application easy.
# for the platforms Linux and Mac OS X.
#
# The travis-ci servers are going to run this script on any push
# to the repo. Basically, it
# - tells the author of a commit if his commit has broken the build,
# - deploys two .zip containing the linux and osx apps, with the
#   touistc compiled in it
#

language: java
os:
  - linux
  - osx
# Install packages using apt-get on linux environment
addons:
  apt:
    sources:
    - avsm
    packages:
    - opam
before_install:
  # Install packages using brew on osx environment
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update && brew install opam ant; fi
  - opam init --auto-setup
  - eval `opam config env`
  - opam install --yes ocamlfind menhir fileutils
install:
  - cd touist-translator
  - ./configure --bindir ../touist-gui/external
  - make && make install
  - cd ../touist-gui
  - chmod ugo+x external/touistc  
  - ant zip
  - zip=$(ls | grep 'touist.*\.zip' | head -1)
script:
  - echo "Build succeded. No tests yet."
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: "YAimStqO6NDkMSn6W+e+V2D5EDtPl1GxxVeS1Fgqz2fneD0RyH08MOggDJDKhd3dvi1WVlfv1b+0PXB9QC1BsmKrNhEUjFtM/IkGsrMVnZ3Y4/GjvUtWmmgCHkv9q7XmOmyGaqDXt39pqux3/EyyLgqssLy8maggn+YpgtolPRk="
  file: $zip
  on:
    tags: true
